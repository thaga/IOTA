var JSX={};(function(d){function a(b,e){var a=function(){};a.prototype=e.prototype;var c=new a;for(var d in b){b[d].prototype=c}}function au(c,b){for(var a in b.prototype)if(b.prototype.hasOwnProperty(a))c.prototype[a]=b.prototype[a]}function s(a,b,d){function c(a,b,c){delete a[b];a[b]=c;return c}Object.defineProperty(a,b,{get:function(){return c(a,b,d())},set:function(d){c(a,b,d)},enumerable:true,configurable:true})}function at(a,b,c){return a[b]=a[b]/c|0}var an=parseInt;var u=parseFloat;function as(a){return a!==a}var w=isFinite;var x=encodeURIComponent;var A=decodeURIComponent;var C=encodeURI;var R=decodeURI;var ai=Object.prototype.toString;var aj=Object.prototype.hasOwnProperty;function f(){}d.require=function(b){var a=t[b];return a!==undefined?a:null};d.profilerIsRunning=function(){return f.getResults!=null};d.getProfileResults=function(){return(f.getResults||function(){return{}})()};d.postProfileResults=function(a,b){if(f.postResults==null)throw new Error('profiler has not been turned on');return f.postResults(a,b)};d.resetProfileResults=function(){if(f.resetResults==null)throw new Error('profiler has not been turned on');return f.resetResults()};d.DEBUG=false;function am(){};a([am],Error);function l(){};a([l],Object);function ar(i){var a;var g;var h;var d;var c;var e;var f;a=b.A.getElementById('iota_canvas');if(a){a.style.position='absolute';a.style.left='0px';a.style.top='0px';g=b.A.getElementById('iota_input');h=new p(a,g);a.width=b._.innerWidth;a.height=b._.innerHeight;b._.onresize=function(c){a.width=b._.innerWidth;a.height=b._.innerHeight;h.P()}}d=b._.document.getElementsByTagName('canvas');for(c=0;c<d.length;++c){e=d[c];f=e.dataset.thetaImg;if(f){(function(c,d){var a;a=b._.document.createElement('img');a.onload=function(b){new k(c,null,a,c.dataset.iotaFisheye!=null)};a.src=d}(e,f))}}};l.main=ar;function k(c,C,P,x){var Q=this;var K;var B;var O;var N;var a;var M;var L;var A;var t;var r;var o;var q;var p;var s;var d;var w;var m;var D;var E;var f;var G;var H;var j;var k;var v;var u;var y;var z;var l;var J;var F;var I;this.P=null;K=128;B=64;function O(c,e){var d;var a;var b;d=new Float32Array((c+1)*(e+1)*2);for(a=0;a<=e;++a){for(b=0;b<=c;++b){d[(a*(c+1)+b)*2]=b/c;d[(a*(c+1)+b)*2+1]=a/e}}return d}function N(b,f){var d;var e;var a;var c;d=(b+1)*2+2;e=new Uint16Array(d*f);for(a=0;a<f;++a){for(c=0;c<=b;++c){e[a*d+c*2]=(a+1)*(b+1)+c;e[a*d+c*2+1]=a*(b+1)+c}e[a*d+(b+1)*2]=(a+1)*(b+1)+b;e[a*d+(b+1)*2+1]=(a+1)*(b+1)+b}return e}a=c.getContext('experimental-webgl',{premultipliedAlpha:false});M=a.createBuffer();a.bindBuffer(a.ARRAY_BUFFER,M);a.bufferData(a.ARRAY_BUFFER,O(K|0,B|0),a.STATIC_DRAW);L=a.createBuffer();A=N(K|0,B|0);a.bindBuffer(a.ELEMENT_ARRAY_BUFFER,L);a.bufferData(a.ELEMENT_ARRAY_BUFFER,A,a.STATIC_DRAW);a.vertexAttribPointer(0,2,a.FLOAT,false,0,0);a.enableVertexAttribArray(0);t=a.createShader(a.VERTEX_SHADER);a.shaderSource(t,'\n			precision mediump float;\n			uniform mat4 projectionMatrix;\n			uniform mat4 modelviewMatrix;\n			attribute vec2 position;\n			varying vec2 v_texcoord;\n			void main() {\n				float h = (position.x + 0.25) * 3.14159265 * 2.0;\n				float v = (position.y - 0.5) * 3.14159265;\n				float hc = cos(h), hs = sin(h);\n				float vc = cos(v), vs = sin(v);\n				v_texcoord = position;\n				gl_Position = projectionMatrix * modelviewMatrix * vec4(vc * hc, vs, vc * hs, 1.0);\n			}\n		');a.compileShader(t);if(!!!a.getShaderParameter(t,a.COMPILE_STATUS)){console.log(a.getShaderInfoLog(t))}r=a.createShader(a.VERTEX_SHADER);a.shaderSource(r,'\n			precision mediump float;\n			uniform mat4 projectionMatrix;\n			uniform mat4 modelviewMatrix;\n			attribute vec2 position;\n			varying vec2 v_texcoord;\n			void main() {\n				v_texcoord = position;\n				float h = (position.x + 0.25) * 3.14159265 * 2.0;\n				float v = (position.y - 0.5) * 3.14159265;\n				float hc = cos(h), hs = sin(h);\n				float vc = cos(v), vs = sin(v);\n				vec3 p = (modelviewMatrix * vec4(vc * hc, vs, vc * hs, 1.0)).xyz;\n				float n = -projectionMatrix[3][2] - 1.0;\n				\n				// 等距離射影\n				float phi = atan(p.y, p.x);\n				float r = 4.0 * sqrt(n) * acos(-p.z);\n				gl_Position = projectionMatrix * vec4(r * cos(phi), r * sin(phi), p.z - n - 0.9, 1.0);\n				\n				// 回転放物面への等距離射影(?) (t-potさんとこのやつ)\n//				float xy2 = dot(p.xy, p.xy);\n//				float d = length(p);\n//				gl_Position = projectionMatrix * vec4(p.x * (d + p.z) / xy2, p.y * (d + p.z) / xy2, p.z -n - 0.9, 1.0);\n			}\n		');a.compileShader(r);if(!!!a.getShaderParameter(r,a.COMPILE_STATUS)){console.log(a.getShaderInfoLog(r))}o=a.createShader(a.FRAGMENT_SHADER);a.shaderSource(o,'\n			precision mediump float;\n			uniform sampler2D texture;\n			varying vec2 v_texcoord;\n			void main() {\n				gl_FragColor = texture2D(texture, v_texcoord);\n			}\n		');a.compileShader(o);if(!!!a.getShaderParameter(o,a.COMPILE_STATUS)){console.log(a.getShaderInfoLog(o))}q=a.createProgram();a.attachShader(q,t);a.attachShader(q,o);a.linkProgram(q);if(!!!a.getProgramParameter(q,a.LINK_STATUS)){console.log(a.getProgramInfoLog(q))}p=a.createProgram();a.attachShader(p,r);a.attachShader(p,o);a.linkProgram(p);if(!!!a.getProgramParameter(p,a.LINK_STATUS)){console.log(a.getProgramInfoLog(p))}s=null;d=.1;w=0;m=0;D=0;E=0;function f(){var l;var k;var b;var f;var j;var o;var r;var L;var O;var S;var z;var B;var C;var y;var G;var H;var I;var J;var K;var u;var M;var N;var v;var P;var Q;var R;var t;var F;if(!s){return}l=c.width;k=c.height;o=l/k;b=1>=o?1:o;r=k/l;f=1>=r?1:r;j=x?p:q;a.useProgram(j);a.uniform1i(a.getUniformLocation(j,'texture'),0);a.uniformMatrix4fv(a.getUniformLocation(j,'projectionMatrix'),false,x?h((L=-b,O=-f,S=d+2,ap(new e,L,b,O,f,d,S))):h((z=-.1*b,B=.1*b,C=-.1*f,y=.1*f,G=d+1,ao(new e,z,B,C,y,d,G))));a.uniformMatrix4fv(a.getUniformLocation(j,'modelviewMatrix'),false,h((t=(v=(u=(H=-m,I=new e,g(I,H,1,0,0)),M=(J=-w,K=new e,g(K,J,0,1,0)),n(u,new i(u),M)),P=(N=new e,g(N,E,1,0,0)),n(v,new i(v),P)),F=(Q=-D,R=new e,g(R,Q,0,0,1)),n(t,new i(t),F))));a.viewport(0,0,l,k);a.clearColor(.1,.2,.3,1);a.clear(a.COLOR_BUFFER_BIT);a.drawElements(a.TRIANGLE_STRIP,A.length,a.UNSIGNED_SHORT,0)}this.P=f;function G(b){if(!s){s=a.createTexture();a.bindTexture(a.TEXTURE_2D,s)}a.pixelStorei(a.UNPACK_ALIGNMENT,1);a.pixelStorei(a.UNPACK_FLIP_Y_WEBGL,1);a.bindTexture(a.TEXTURE_2D,s);a.texImage2D(a.TEXTURE_2D,0,a.RGB,a.RGB,a.UNSIGNED_BYTE,b);a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_S,a.CLAMP_TO_EDGE);a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_T,a.CLAMP_TO_EDGE);a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MIN_FILTER,a.LINEAR);a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MAG_FILTER,a.LINEAR);f()}function H(a){d*=Math.pow(.9,a);if(d>.9){d=.9}if(d<.01){d=.01}f()}if(P){G(P)}j=null;k=-1;function v(c){var d;var e;var a;if(!j){return}if(c<0||c>=j.length){return}d=j[c];e=new FileReader;e.onload=function(c){var a;a=b.A.createElement('img');a.onload=function(b){w=0;m=0;G(a)};a.src=c.target.result};e.readAsDataURL(d);a=new FileReader;a.onload=function(q){var i;var c;var b;var h;var j;var d;var e;var g;var m;var n;var o;var p;var k;var l;i=a.result+'';c=new Uint8Array(i.length);b=0;for(b=0;b<c.length;++b){c[b]=i.charCodeAt(b)&255}h=[0,3,0,10,0,0,0,2];j=1e4;for(d=0;d<j;++d){for(b=0;b<h.length;++b){if(c[b+d]!==h[b]){break}}if(b===h.length){break}}if(d===j){return}d+=h.length;function e(a,b){return a[b]<<24|a[b+1]<<16|a[b+2]<<8|a[b+3]}g=e(c,d|0)+12;if(g>c.length-16){return}m=e(c,g|0);n=e(c,g+4|0);o=e(c,g+8|0);p=e(c,g+12|0);k=m/n;l=o/p;D=k*Math.PI/180;E=l*Math.PI/180;f()};a.readAsBinaryString(d)}if(C){C.onchange=function(a){j=C.files;v((k=0)|0)}}c.ondragover=function(a){a.preventDefault()};c.ondrop=function(a){var b;a.preventDefault();b=a;j=b.dataTransfer.files;v((k=0)|0)};c.onmousewheel=function(a){var b;a.preventDefault();b=a;H(+b.wheelDelta/-120)};c.addEventListener('DOMMouseScroll',function(a){var b;a.preventDefault();b=a;H(b.detail/3)},false);u=false;y=0;z=0;c.onmousedown=function(b){var a;b.preventDefault();a=b;if(a.button===0){u=true;y=a.clientX;z=a.clientY}};c.onmouseup=function(a){var b;a.preventDefault();b=a;if(b.button===0){u=false}};c.onmouseout=function(a){u=false};c.onmousemove=function(e){var a;var b;e.preventDefault();a=e;if(u){b=1/Math.sqrt(c.width*c.height*d);w+=(a.clientX-y)*b;m+=(a.clientY-z)*b;if(m>1.570796325){m=1.570796325}if(m<-1.570796325){m=-1.570796325}f();y=a.clientX;z=a.clientY}};l=false;J=false;F=0;I=0;c.ondblclick=function(g){var d;var a;var e;d=c;a=c;if(d.mozRequestFullScreen){function e(d){var a;if(l){c.width=F;c.height=I;l=false}else{a=b.A.mozFullScreenElement;if(a==c){c.width=b._.innerWidth;c.height=b._.innerHeight;l=true}}f()}if(!J){b.A.addEventListener('mozfullscreenchange',e);J=true}if(!l){F=c.width;I=c.height;a.mozRequestFullScreen()}}if(d.webkitRequestFullScreen){if(!l){a.onwebkitfullscreenchange=function(g){var d;var e;l=true;d=c.width;e=c.height;c.width=b._.innerWidth;c.height=b._.innerHeight;f();a.onwebkitfullscreenchange=function(a){l=false;c.width=d;c.height=e;f()}};a.webkitRequestFullScreen()}}};b._.addEventListener('keydown',function(b){var a;a=b;switch(a.keyCode){default:console.log('unknown key code: ',a.keyCode);break;case 37:if(j&&--k>=0){v(k|0)}else{k=0}break;case 39:if(j&&++k<j.length){v(k|0)}else{k=j.length-1}break;case 70:x=!x;f();break}})};function p(a,b){var c=this;k.call(this,a,b,null,false)};a([k,p],Object);function b(){};a([b],Object);function c(){};a([c],Object);function y(){};a([y],c);function z(){};a([z],Object);function q(){};a([q],c);function B(){};a([B],Object);function r(){};a([r],q);function D(){};a([D],Object);function E(){};a([E],Object);function F(){};a([F],Object);function G(){};a([G],c);function H(){};a([H],Object);function I(){};a([I],Object);function J(){};a([J],c);function K(){};a([K],c);function L(){};a([L],c);function M(){};a([M],c);function N(){};a([N],c);function O(){};a([O],r);function P(){};a([P],c);function Q(){};a([Q],c);function ak(){};a([ak],c);function S(){};a([S],Object);function T(){};a([T],Object);function U(){};a([U],Object);function V(){};a([V],c);function W(){};a([W],Object);function X(){};a([X],Object);function Y(){};a([Y],Object);function Z(){};a([Z],Object);function _(){};a([_],Object);function $(){};a([$],Object);function a0(){};a([a0],c);function a1(){};a([a1],c);function a2(){};a([a2],c);function a3(){};a([a3],Object);function a4(){};a([a4],Object);function a5(){};a([a5],Object);function a6(){};a([a6],Object);function a7(){};a([a7],c);function a8(){};a([a8],c);function a9(){};a([a9],c);function aa(){};a([aa],Object);function ab(){};a([ab],Object);function ac(){};a([ac],Object);function ad(){};a([ad],Object);function ae(){};a([ae],Object);function af(){};a([af],Object);function ag(){};a([ag],Object);function ah(){};a([ah],Object);function e(){this._=0;this.D=0;this.H=0;this.L=0;this.A=0;this.E=0;this.I=0;this.M=0;this.B=0;this.F=0;this.J=0;this.N=0;this.C=0;this.G=0;this.K=0;this.O=0};function i(a){this._=0;this.D=0;this.H=0;this.L=0;this.A=0;this.E=0;this.I=0;this.M=0;this.B=0;this.F=0;this.J=0;this.N=0;this.C=0;this.G=0;this.K=0;this.O=0;al(this,a)};a([e,i],Object);function h(a){return[a._,a.D,a.H,a.L,a.A,a.E,a.I,a.M,a.B,a.F,a.J,a.N,a.C,a.G,a.K,a.O]};function al(a,b){a._=b._;a.D=b.D;a.H=b.H;a.L=b.L;a.A=b.A;a.E=b.E;a.I=b.I;a.M=b.M;a.B=b.B;a.F=b.F;a.J=b.J;a.N=b.N;a.C=b.C;a.G=b.G;a.K=b.K;a.O=b.O;return a};e.prototype.R=function(a){this._=a[0];this.D=a[1];this.H=a[2];this.L=a[3];this.A=a[4];this.E=a[5];this.I=a[6];this.M=a[7];this.B=a[8];this.F=a[9];this.J=a[10];this.N=a[11];this.C=a[12];this.G=a[13];this.K=a[14];this.O=a[15];return this};function n(a,b,c){var e;var f;var g;var h;var i;var j;var k;var l;var m;var n;var o;var p;var q;var r;var d;var t;var u;var v;var w;var x;var y;var z;var A;var B;var C;var D;var E;var F;var G;var H;var I;var s;a._=(i=b._)*(e=c._)+(j=b.A)*(f=c.D)+(k=b.B)*(g=c.H)+(l=b.C)*(h=c.L);a.D=(m=b.D)*e+(o=b.E)*f+(q=b.F)*g+(d=b.G)*h;a.H=(u=b.H)*e+(v=b.I)*f+(w=b.J)*g+(x=b.K)*h;a.L=(y=b.L)*e+(z=b.M)*f+(A=b.N)*g+(B=b.O)*h;a.A=i*(n=c.A)+j*(p=c.E)+k*(r=c.I)+l*(t=c.M);a.E=m*n+o*p+q*r+d*t;a.I=u*n+v*p+w*r+x*t;a.M=y*n+z*p+A*r+B*t;a.B=i*(C=c.B)+j*(D=c.F)+k*(E=c.J)+l*(F=c.N);a.F=m*C+o*D+q*E+d*F;a.J=u*C+v*D+w*E+x*F;a.N=y*C+z*D+A*E+B*F;a.C=i*(G=c.C)+j*(H=c.G)+k*(I=c.K)+l*(s=c.O);a.G=m*G+o*H+q*I+d*s;a.K=u*G+v*H+w*I+x*s;a.O=y*G+z*H+A*I+B*s;return a};function g(a,j,c,d,b){var i;var h;var g;var f;var e;i=Math.sqrt(c*c+d*d+b*b);if(i===0){return null}h=1/ i;c*=h;d*=h;b*=h;g=Math.cos(j),f=Math.sin(j);e=1-g;a._=c*c*e+g;a.D=d*c*e+b*f;a.H=c*b*e-d*f;a.A=c*d*e-b*f;a.E=d*d*e+g;a.I=d*b*e+c*f;a.B=c*b*e+d*f;a.F=d*b*e-c*f;a.J=b*b*e+g;a.L=a.M=a.N=a.C=a.G=a.K=0;a.O=1;return a};function ao(a,g,h,i,j,b,d){var e;var f;var c;e=h-g,f=j-i,c=d-b;a._=2*b/e;a.E=2*b/f;a.B=(h+g)/e;a.F=(j+i)/f;a.J=-(d+b)/c;a.N=-1;a.K=-2*d*b/c;a.D=a.H=a.L=a.A=a.I=a.M=a.C=a.G=a.O=0;return a};function ap(a,i,j,e,f,g,h){var c;var d;var b;c=j-i,d=f-e,b=h-g;a._=2/c;a.E=2/d;a.J=-2/b;a.C=-(j+i)/c;a.G=-(f+e)/d;a.K=-(h+g)/b;a.D=a.H=a.L=a.A=a.I=a.M=a.B=a.F=a.N=0;a.O=1;return a};e.prototype.toString=function(){return'M44'+JSON.stringify(h(this))};function aq(){};a([aq],Object);function o(){};a([o],Object);function v(a){};o.main=v;var m=function(){var a=function(){return this}();return{global:a,eval:a.eval,invoke:function(a,b,c){return a[b].apply(a,c)}}}();s(b,'_',function(){return m.global.window});s(b,'A',function(){return m.global.document});var t={'iota.jsx':{_Main:l},'mvq.jsx':{_Main:o}};d.runMain=function(b,c){var a=d.require(b);if(!a){throw new ReferenceError('entry point module not found in '+b)}if(!a._Main){throw new ReferenceError('entry point _Main not found in '+b)}if(!a._Main.main){throw new ReferenceError('entry point _Main.main(:string[]):void not found in '+b)}a._Main.main(c)};d.runTests=function(i,b){var g=d.require(i);if(!g)return;var c=g._Test;if(!c)return;if(b.length===0){var h=c.prototype;for(var e in h){if(h[e]instanceof Function&&e.match(/^test\w*$/)){b.push(e)}}}var a=new c;if(a.beforeClass!=null)a.beforeClass(b);for(var f=0;f<b.length;++f){(function(b){if(b in a){a.run(b,function(){a[b]()})}else{throw new ReferenceError('No such test method: '+b)}}(b[f]))}if(a.afterClass!=null)a.afterClass()};function j(a){window.removeEventListener('load',j);document.removeEventListener('DOMContentLoaded',j);d.runMain('iota.jsx',[])}window.addEventListener('load',j);document.addEventListener('DOMContentLoaded',j)}(JSX))